<div class="min-h-screen bg-gray-50 py-6 sm:py-8 px-3 sm:px-6 lg:px-8">
  <div class="max-w-4xl mx-auto w-full">
    <!-- Header -->
    <div class="text-center mb-6 sm:mb-8">
      <h1 class="text-xl sm:text-3xl font-bold text-gray-900 mb-2">
        ส่งข้อมูลหอพัก
      </h1>
      <p class="text-sm sm:text-base text-gray-600">
        กรอกข้อมูลหอพักของคุณให้ครบถ้วน เพื่อให้ผู้เช่าค้นหาได้ง่าย
      </p>
    </div>

    <!-- Progress Bar -->
    <div class="mb-6 sm:mb-8">
      <div class="flex items-center justify-between mb-2">
        <span class="text-xs sm:text-sm font-medium text-gray-700">{{
          getStepTitle()
        }}</span>
        <span class="text-xs sm:text-sm text-gray-500"
          >{{ currentStep }}/{{ totalSteps }}</span
        >
      </div>
      <div class="w-full bg-gray-200 rounded-full h-2">
        <div
          class="bg-yellow-500 h-2 rounded-full transition-all duration-300"
          [style.width.%]="(currentStep / totalSteps) * 100"
        ></div>
      </div>
    </div>

    <!-- Form Container -->
    <div class="bg-white rounded-lg shadow-lg p-4 sm:p-8">
      <form [formGroup]="dormForm" (ngSubmit)="onSubmit()">
        <!-- Step 1: ข้อมูลหอพัก -->
        <div *ngIf="currentStep === 1" class="space-y-6">
          <h2 class="text-xl font-semibold text-gray-900 mb-4">ข้อมูลหอพัก</h2>

          <div class="grid grid-cols-1 gap-6">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                ชื่อหอพัก <span class="text-red-500">*</span>
              </label>
              <input
                type="text"
                formControlName="dorm_name"
                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500"
                placeholder="เช่น อันดา เพลส ขามเรียง ซอยเซเว่น 1"
              />
              <div
                *ngIf="
                  dormForm.get('dorm_name')?.invalid &&
                  dormForm.get('dorm_name')?.touched
                "
                class="text-red-500 text-sm mt-1"
              >
                กรุณากรอกชื่อหอพัก (อย่างน้อย 3 ตัวอักษร)
              </div>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                ที่อยู่หอพัก <span class="text-red-500">*</span>
              </label>
              <textarea
                formControlName="address"
                rows="3"
                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500"
                placeholder="ระบุที่อยู่หอพักให้ละเอียด"
              ></textarea>
              <div
                *ngIf="
                  dormForm.get('address')?.invalid &&
                  dormForm.get('address')?.touched
                "
                class="text-red-500 text-sm mt-1"
              >
                กรุณากรอกที่อยู่ให้ครบถ้วน (อย่างน้อย 10 ตัวอักษร)
              </div>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                โซน/พื้นที่ <span class="text-red-500">*</span>
              </label>
              <select
                formControlName="zone_name"
                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500"
              >
                <option value="">
                  {{ isLoadingData ? "กำลังโหลด..." : "เลือกโซน/พื้นที่" }}
                </option>
                <option *ngFor="let zone of zones" [value]="zone.zone_name">
                  {{ zone.zone_name }}
                </option>
              </select>
              <div
                *ngIf="
                  dormForm.get('zone_name')?.invalid &&
                  dormForm.get('zone_name')?.touched
                "
                class="text-red-500 text-sm mt-1"
              >
                กรุณาเลือกโซน/พื้นที่
              </div>
            </div>
          </div>
        </div>

        <!-- Step 2: ข้อมูลติดต่อ -->
        <div *ngIf="currentStep === 2" class="space-y-6">
          <h2 class="text-xl font-semibold text-gray-900 mb-4">
            ข้อมูลติดต่อ (ไม่บังคับ)
          </h2>

          <div class="grid grid-cols-1 gap-6">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                ชื่อผู้ติดต่อ
              </label>
              <input
                type="text"
                formControlName="contact_name"
                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500"
                placeholder="เช่น คุณสมชาย"
              />
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                เบอร์โทรศัพท์
              </label>
              <input
                type="tel"
                formControlName="contact_phone"
                maxlength="10"
                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500"
                placeholder="เช่น 0812345678"
              />
              <div
                *ngIf="
                  dormForm.get('contact_phone')?.invalid &&
                  dormForm.get('contact_phone')?.touched
                "
                class="text-red-500 text-sm mt-1"
              >
                กรุณากรอกเบอร์โทรศัพท์ให้ถูกต้อง (9-10 หลัก)
              </div>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                อีเมล
              </label>
              <input
                type="email"
                formControlName="contact_email"
                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500"
                placeholder="เช่น contact@example.com"
              />
              <div
                *ngIf="
                  dormForm.get('contact_email')?.invalid &&
                  dormForm.get('contact_email')?.touched
                "
                class="text-red-500 text-sm mt-1"
              >
                กรุณากรอกอีเมลให้ถูกต้อง
              </div>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Line ID
              </label>
              <input
                type="text"
                formControlName="line_id"
                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500"
                placeholder="เช่น @dormname"
              />
            </div>
          </div>
        </div>

        <!-- Step 3: ประเภทห้องและราคา -->
        <div *ngIf="currentStep === 3" class="space-y-6">
          <h2 class="text-xl font-semibold text-gray-900 mb-4">
            ประเภทห้องและราคา
          </h2>

          <!-- ประเภทห้อง -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              ประเภทห้อง <span class="text-red-500">*</span>
            </label>
            <select
              formControlName="room_type"
              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500"
            >
              <option value="">เลือกประเภทห้อง</option>
              <option *ngFor="let type of roomTypes" [value]="type">
                {{ type }}
              </option>
            </select>
            <div
              *ngIf="
                dormForm.get('room_type')?.invalid &&
                dormForm.get('room_type')?.touched
              "
              class="text-red-500 text-sm mt-1"
            >
              กรุณาเลือกประเภทห้อง
            </div>
          </div>

          <!-- ช่องกรอกประเภทห้องอื่นๆ -->
          <div *ngIf="dormForm.get('room_type')?.value === 'อื่นๆ'">
            <label class="block text-sm font-medium text-gray-700 mb-2">
              ระบุประเภทห้อง <span class="text-red-500">*</span>
            </label>
            <input
              type="text"
              formControlName="room_type_other"
              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500"
              placeholder="เช่น ห้องสตูดิโอ"
            />
            <div
              *ngIf="
                !dormForm.get('room_type_other')?.value &&
                dormForm.get('room_type')?.value === 'อื่นๆ'
              "
              class="text-red-500 text-sm mt-1"
            >
              กรุณาระบุประเภทห้อง
            </div>
          </div>

          <!-- ราคา (ต้องเลือกอย่างน้อย 1) -->
          <div class="border-t pt-4">
            <p class="text-sm font-medium text-gray-700 mb-4">
              ราคา <span class="text-red-500">*</span>
              <span class="text-gray-500 font-normal"
                >(เลือกอย่างน้อย 1 รายการ)</span
              >
            </p>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  ราคาต่อเดือน (บาท)
                </label>
                <input
                  type="number"
                  formControlName="monthly_price"
                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500"
                  placeholder="เช่น 3500"
                  min="0"
                />
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  ราคาต่อวัน (บาท)
                </label>
                <input
                  type="number"
                  formControlName="daily_price"
                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500"
                  placeholder="เช่น 150"
                  min="0"
                />
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  ราคาซัมเมอร์ (บาท)
                </label>
                <input
                  type="number"
                  formControlName="summer_price"
                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500"
                  placeholder="เช่น 9000"
                  min="0"
                />
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  ค่าประกันห้อง (บาท)
                </label>
                <input
                  type="number"
                  formControlName="deposit"
                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500"
                  placeholder="เช่น 3500"
                  min="0"
                />
              </div>
            </div>

            <!-- Error message ถ้าไม่เลือกราคา -->
            <div
              *ngIf="
                dormForm.errors?.['atLeastOnePrice'] &&
                (dormForm.get('monthly_price')?.touched ||
                  dormForm.get('daily_price')?.touched)
              "
              class="text-red-500 text-sm mt-2 font-medium"
            >
              กรุณากรอกราคาอย่างน้อย 1 รายการ (รายเดือน หรือ รายวัน)
            </div>
          </div>

          <!-- ค่าน้ำค่าไฟ -->
          <div class="border-t pt-4">
            <p class="text-sm font-medium text-gray-700 mb-4">
              ค่าน้ำค่าไฟ
            </p>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  ค่าไฟ (บาท/หน่วย)
                </label>
                <input
                  type="number"
                  formControlName="electricity_price"
                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500"
                  placeholder="เช่น 8"
                  min="0"
                  step="0.01"
                />
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  ประเภทค่าน้ำ
                </label>
                <select
                  formControlName="water_price_type"
                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500"
                >
                  <option value="">เลือกประเภท</option>
                  <option value="per_unit">คิดตามหน่วย (บาท/หน่วย)</option>
                  <option value="flat_rate">คิดรายเดือน (บาท/เดือน)</option>
                </select>
              </div>

              <div class="sm:col-span-2">
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  <span *ngIf="dormForm.get('water_price_type')?.value === 'per_unit'">
                    ค่าน้ำ (บาท/หน่วย)
                  </span>
                  <span *ngIf="dormForm.get('water_price_type')?.value === 'flat_rate'">
                    ค่าน้ำ (บาท/เดือน)
                  </span>
                  <span *ngIf="!dormForm.get('water_price_type')?.value">
                    ค่าน้ำ
                  </span>
                </label>
                <input
                  type="number"
                  formControlName="water_price"
                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500"
                  [placeholder]="dormForm.get('water_price_type')?.value === 'per_unit' ? 'เช่น 25' : dormForm.get('water_price_type')?.value === 'flat_rate' ? 'เช่น 100' : 'เลือกประเภทค่าน้ำก่อน'"
                  [disabled]="!dormForm.get('water_price_type')?.value"
                  min="0"
                  step="0.01"
                />
              </div>
            </div>
          </div>
        </div>

        <!-- Step 4: รูปภาพและข้อมูลเพิ่มเติม -->
        <div *ngIf="currentStep === 4" class="space-y-6">
          <h2 class="text-xl font-semibold text-gray-900 mb-4">
            รูปภาพและข้อมูลเพิ่มเติม
          </h2>

          <!-- Image Upload Section -->
          <div class="space-y-4">
            <div class="flex justify-between items-center">
              <h3 class="text-lg font-medium text-gray-900">
                รูปภาพหอพัก <span class="text-red-500">*</span>
              </h3>
              <span
                class="text-sm"
                [class.text-red-500]="images.length < minImages"
                [class.text-gray-500]="images.length >= minImages"
              >
                {{ images.length }}/{{ maxImages }} รูป (ขั้นต่ำ
                {{ minImages }} รูป)
              </span>
            </div>

            <!-- Upload Buttons -->
            <div class="flex flex-col sm:flex-row gap-3">
              <button
                type="button"
                (click)="openCamera()"
                [disabled]="images.length >= maxImages"
                class="flex-1 flex items-center justify-center px-4 py-3 border-2 border-dashed border-gray-300 rounded-lg hover:border-yellow-500 hover:bg-yellow-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
              >
                <svg
                  class="w-6 h-6 mr-2 text-gray-400"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"
                  ></path>
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"
                  ></path>
                </svg>
                <span class="text-sm font-medium text-gray-700">ถ่ายรูป</span>
              </button>

              <button
                type="button"
                (click)="openGallery()"
                [disabled]="images.length >= maxImages"
                class="flex-1 flex items-center justify-center px-4 py-3 border-2 border-dashed border-gray-300 rounded-lg hover:border-yellow-500 hover:bg-yellow-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
              >
                <svg
                  class="w-6 h-6 mr-2 text-gray-400"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"
                  ></path>
                </svg>
                <span class="text-sm font-medium text-gray-700"
                  >เลือกจากเครื่อง</span
                >
              </button>
            </div>

            <!-- Hidden File Inputs -->
            <input
              #cameraInput
              type="file"
              accept="image/*"
              capture="environment"
              (change)="onCameraCapture($event)"
              class="hidden"
            />

            <input
              #fileInput
              type="file"
              accept="image/*"
              multiple
              (change)="onGallerySelect($event)"
              class="hidden"
            />

            <!-- Error message -->
            <div
              *ngIf="images.length < minImages && currentStep === 4"
              class="text-red-500 text-sm font-medium bg-red-50 border border-red-200 rounded-lg p-3 mt-2"
            >
              ⚠️ กรุณาอัพโหลดรูปภาพอย่างน้อย {{ minImages }} รูป
            </div>

            <!-- Image Preview Grid -->
            <div
              *ngIf="images.length > 0"
              class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4"
            >
              <div
                *ngFor="let image of images; let i = index"
                class="relative group"
              >
                <img
                  [src]="image.preview"
                  [alt]="'รูปภาพ ' + (i + 1)"
                  class="w-full h-24 sm:h-32 object-cover rounded-lg border-2"
                  [class.border-yellow-500]="image.isPrimary"
                  [class.border-gray-200]="!image.isPrimary"
                />

                <!-- Remove Button -->
                <button
                  type="button"
                  (click)="removeImage(i)"
                  class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity"
                >
                  <svg
                    class="w-4 h-4"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M6 18L18 6M6 6l12 12"
                    ></path>
                  </svg>
                </button>

                <!-- Primary Badge -->
                <div
                  *ngIf="image.isPrimary"
                  class="absolute top-1 left-1 px-2 py-1 bg-yellow-500 text-white text-xs rounded"
                >
                  รูปหลัก
                </div>

                <!-- Set Primary Button -->
                <button
                  *ngIf="!image.isPrimary"
                  type="button"
                  (click)="setPrimaryImage(i)"
                  class="absolute bottom-1 left-1 px-2 py-1 bg-black bg-opacity-50 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity"
                >
                  ตั้งเป็นรูปหลัก
                </button>
              </div>
            </div>
          </div>

          <!-- Amenities -->
          <div formGroupName="amenities" *ngIf="amenities.length > 0">
            <div class="flex items-center justify-between mb-3">
              <h3 class="text-lg font-medium text-gray-900">
                สิ่งอำนวยความสะดวก <span class="text-red-500">*</span>
              </h3>
              <span 
                class="text-sm"
                [class.text-red-500]="getSelectedAmenities().length < 5"
                [class.text-green-600]="getSelectedAmenities().length >= 5"
              >
                {{ getSelectedAmenities().length }}/{{ amenities.length }} 
                (ขั้นต่ำ 5 อย่าง)
              </span>
            </div>
            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3">
              <label
                *ngFor="let amenity of amenities"
                class="flex items-center space-x-2 cursor-pointer"
              >
                <input
                  type="checkbox"
                  [formControlName]="amenity"
                  class="rounded border-gray-300 text-yellow-500 focus:ring-yellow-500"
                />
                <span class="text-base text-gray-700">{{ amenity }}</span>
              </label>
            </div>
            
            <!-- Error message -->
            <div
              *ngIf="getSelectedAmenities().length < 5 && currentStep === 4"
              class="text-red-500 text-sm font-medium bg-red-50 border border-red-200 rounded-lg p-3 mt-3"
            >
              ⚠️ กรุณาเลือกสิ่งอำนวยความสะดวกอย่างน้อย 5 อย่าง (เลือกแล้ว {{ getSelectedAmenities().length }} อย่าง)
            </div>
          </div>

          <!-- Description -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              รายละเอียดเพิ่มเติม
            </label>
            <textarea
              formControlName="description"
              rows="4"
              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500"
              placeholder="เช่น หอพักใหม่ สะอาด ปลอดภัย ใกล้มหาวิทยาลัย ห้ามสูบบุหรี่ ห้ามเลี้ยงสัตว์..."
            ></textarea>
          </div>

          <!-- Map Picker -->
          <div>
            <h3 class="text-lg font-medium text-gray-900 mb-2">
              ระบุพิกัดหอพัก <span class="text-red-500">*</span>
            </h3>

            <div class="relative">
              <div
                #mapContainer
                class="w-full h-96 rounded-lg border-2 border-gray-300"
              ></div>

              <!-- Loading Overlay -->
              <div
                *ngIf="isLoadingLocation"
                class="absolute inset-0 bg-white bg-opacity-75 backdrop-blur-sm flex items-center justify-center rounded-lg z-20"
              >
                <div class="text-center">
                  <dotlottie-wc 
                    src="https://lottie.host/4ca30491-9eb8-449b-9364-082d966730b6/4MWuEhq1d7.lottie" 
                    style="width: 200px; height: 200px; margin: 0 auto;"
                    autoplay 
                    loop>
                  </dotlottie-wc>
                  <p class="text-gray-700 font-medium mt-2">
                    กำลังค้นหาตำแหน่งของคุณ...
                  </p>
                </div>
              </div>

              <!-- Map Controls Overlay -->
              <div class="absolute top-4 left-4 flex flex-col gap-2 z-10">
                <!-- ปุ่มตำแหน่งปัจจุบัน -->
                <button
                  type="button"
                  (click)="getCurrentLocation()"
                  [disabled]="isLoadingLocation"
                  class="w-[33px] h-[33px] bg-white rounded-sm shadow-lg hover:bg-gray-50 transition-colors flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed"
                  title="ตำแหน่งปัจจุบัน"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="2"
                    stroke="currentColor"
                    class="w-4 h-4 text-blue-600"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z"
                    />
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z"
                    />
                  </svg>
                </button>

                <!-- ปุ่มเปลี่ยนแผนที่ -->
                <button
                  type="button"
                  (click)="toggleMapStyle()"
                  class="w-[33px] h-[33px] bg-white rounded-sm shadow-lg hover:bg-gray-50 transition-colors flex items-center justify-center"
                  [title]="
                    currentMapStyle === 'satellite'
                      ? 'เปลี่ยนเป็นแผนที่ถนน'
                      : 'เปลี่ยนเป็นดาวเทียม'
                  "
                >
                  <!-- Icon แผนที่ (เมื่ออยู่โหมด Satellite) -->
                  <svg
                    *ngIf="currentMapStyle === 'satellite'"
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="2"
                    stroke="currentColor"
                    class="w-4 h-4 text-gray-700"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M9 6.75V15m6-6v8.25m.503 3.498l4.875-2.437c.381-.19.622-.58.622-1.006V4.82c0-.836-.88-1.38-1.628-1.006l-3.869 1.934c-.317.159-.69.159-1.006 0L9.503 3.252a1.125 1.125 0 00-1.006 0L3.622 5.689C3.24 5.88 3 6.27 3 6.695V19.18c0 .836.88 1.38 1.628 1.006l3.869-1.934c.317-.159.69-.159 1.006 0l4.994 2.497c.317.158.69.158 1.006 0z"
                    />
                  </svg>
                  <!-- Icon โลก (เมื่ออยู่โหมด Streets) -->
                  <svg
                    *ngIf="currentMapStyle === 'streets'"
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="2"
                    stroke="currentColor"
                    class="w-5 h-5 text-gray-700"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M12 21a9.004 9.004 0 008.716-6.747M12 21a9.004 9.004 0 01-8.716-6.747M12 21c2.485 0 4.5-4.03 4.5-9S14.485 3 12 3m0 18c-2.485 0-4.5-4.03-4.5-9S9.515 3 12 3m0 0a8.997 8.997 0 017.843 4.582M12 3a8.997 8.997 0 00-7.843 4.582m15.686 0A11.953 11.953 0 0112 10.5c-2.998 0-5.74-1.1-7.843-2.918m15.686 0A8.959 8.959 0 0121 12c0 .778-.099 1.533-.284 2.253m0 0A17.919 17.919 0 0112 16.5c-3.162 0-6.133-.815-8.716-2.247m0 0A9.015 9.015 0 013 12c0-1.605.42-3.113 1.157-4.418"
                    />
                  </svg>
                </button>
              </div>
            </div>

            <div
              class="flex items-start gap-2 mt-3 text-sm text-gray-700 bg-yellow-50 border border-yellow-200 rounded-lg p-3"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="currentColor"
                class="w-4 h-4 flex-shrink-0 mt-0.5 text-yellow-500"
              >
                <path
                  d="M12 .75a8.25 8.25 0 0 0-4.135 15.39c.686.398 1.115 1.008 1.134 1.623a.75.75 0 0 0 .577.706c.352.083.71.148 1.074.195.323.041.6-.218.6-.544v-4.661a6.714 6.714 0 0 1-.937-.171.75.75 0 1 1 .374-1.453 5.261 5.261 0 0 0 2.626 0 .75.75 0 1 1 .374 1.452 6.712 6.712 0 0 1-.937.172v4.66c0 .327.277.586.6.545.364-.047.722-.112 1.074-.195a.75.75 0 0 0 .577-.706c.02-.615.448-1.225 1.134-1.623A8.25 8.25 0 0 0 12 .75Z"
                />
                <path
                  fill-rule="evenodd"
                  d="M9.013 19.9a.75.75 0 0 1 .877-.597 11.319 11.319 0 0 0 4.22 0 .75.75 0 1 1 .28 1.473 12.819 12.819 0 0 1-4.78 0 .75.75 0 0 1-.597-.876ZM9.754 22.344a.75.75 0 0 1 .824-.668 13.682 13.682 0 0 0 2.844 0 .75.75 0 1 1 .156 1.492 15.156 15.156 0 0 1-3.156 0 .75.75 0 0 1-.668-.824Z"
                  clip-rule="evenodd"
                />
              </svg>
              <p>คลิกบนแผนที่หรือลาก marker สีเหลืองเพื่อระบุตำแหน่งหอพัก</p>
            </div>

            <!-- แสดงพิกัดที่เลือก -->
            <div
              *ngIf="
                dormForm.get('latitude')?.value &&
                dormForm.get('longitude')?.value
              "
              class="mt-2 p-3 bg-green-50 border border-green-200 rounded-lg"
            >
              <p class="text-sm text-green-800">
                ✓ พิกัดที่เลือก:
                {{ dormForm.get("latitude")?.value | number: "1.6-6" }},
                {{ dormForm.get("longitude")?.value | number: "1.6-6" }}
              </p>
            </div>

            <!-- Error message -->
            <div
              *ngIf="
                (!dormForm.get('latitude')?.value ||
                  !dormForm.get('longitude')?.value) &&
                currentStep === 4
              "
              class="text-red-500 text-sm font-medium bg-red-50 border border-red-200 rounded-lg p-3 mt-2"
            >
              ⚠️ กรุณาระบุตำแหน่งหอพักบนแผนที่
            </div>
          </div>
        </div>

        <!-- Navigation Buttons -->
        <div
          class="flex flex-col-reverse sm:flex-row justify-between items-stretch sm:items-center pt-6 sm:pt-8 border-t border-gray-200 gap-3 sm:gap-0"
        >
          <!-- ปุ่มย้อนกลับ (แสดงเฉพาะเมื่อไม่ใช่ step แรก) -->
          <button
            type="button"
            (click)="prevStep()"
            *ngIf="currentStep > 1"
            class="w-full sm:w-auto px-4 sm:px-6 py-2.5 sm:py-3 text-sm sm:text-base border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-colors"
          >
            ย้อนกลับ
          </button>

          <!-- ปุ่มด้านขวา -->
          <div class="flex gap-3 w-full sm:w-auto">
            <button
              type="button"
              (click)="router.navigate(['/'])"
              class="flex-1 sm:flex-none px-4 sm:px-6 py-2.5 sm:py-3 text-sm sm:text-base border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-colors"
            >
              ยกเลิก
            </button>

            <button
              type="button"
              (click)="nextStep()"
              *ngIf="currentStep < totalSteps"
              [disabled]="!isStepValid(currentStep)"
              class="flex-1 sm:flex-none px-4 sm:px-6 py-2.5 sm:py-3 text-sm sm:text-base bg-yellow-500 text-white rounded-md hover:bg-yellow-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors"
            >
              ถัดไป
            </button>

            <button
              type="submit"
              *ngIf="currentStep === totalSteps"
              [disabled]="!dormForm.valid || isSubmitting"
              class="flex-1 sm:flex-none px-4 sm:px-6 py-2.5 sm:py-3 text-sm sm:text-base bg-green-600 text-white rounded-md hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors flex items-center justify-center"
            >
              <svg
                *ngIf="isSubmitting"
                class="animate-spin -ml-1 mr-3 h-5 w-5 text-white"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
              >
                <circle
                  class="opacity-25"
                  cx="12"
                  cy="12"
                  r="10"
                  stroke="currentColor"
                  stroke-width="4"
                ></circle>
                <path
                  class="opacity-75"
                  fill="currentColor"
                  d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                ></path>
              </svg>
              {{ isSubmitting ? "กำลังส่งข้อมูล..." : "ส่งข้อมูลหอพัก" }}
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
